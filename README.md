# check_connect
Проверяем подключение к PostgreSQL.
Помогает оценить время не доступности БД.

Скрипт устанавливает соединение с БД,
создает таблицу guzya_"%Y_%m_%d_%H_%M" (int, timestamp),
начинает писать в таблицу.
При обрыве соединения скрипт пытается переподключается с таймоутом ожидания 1 сек,
если коннект не получен, увеличивается счетчик ошибок, увеличивается счетчик строк
и повторяем попытку подключиться.

ОСТАНОВКА СКРИПТА:
Ctrl + c

При завершении работы скрипт выводит:
- количество успешных соединений с базой,
- количество ошибок при работе с базой,
- счетчик строк,
- кол. переданных строк,
- кол. записанных строк,
- мин. задержку м\у соседними строками,
- макс. задержку м\у соседними строками,
- сред. задержку м\у соседними строками

По умолчанию, созданная таблица удаляется.

Запуск скрипта:

python3 check_connect.py --h 172.1.1.228 --p 5432 --d postgres --U postgres --P postgres

python3 check_connect.py --h 172.1.1.228 --p 5432 --d postgres --U postgres --P postgres --C no


## Пример лога при перезапуске PostgreSQL:

2021-03-24 11:28:00,425: main    : module           : INFO    : Начало работы  
2021-03-24 11:28:00,425: main    : main             : INFO    : 172.1.1.228 : 5432 : postgres : postgres :   
2021-03-24 11:28:00,425: main    : main             : INFO    : Приступаю к созданию таблицы.  
2021-03-24 11:28:00,630: main    : main             : INFO    : Получил соединение с БД.  
2021-03-24 11:28:00,630: main    : main             : INFO    : Получил курсор.  
2021-03-24 11:28:00,735: main    : main             : INFO    : Выполнил создание таблицы.  
2021-03-24 11:28:00,735: main    : main             : INFO    : Захожу в цикл проверки...  
2021-03-24 11:28:00,735: main    : main             : INFO    : 1  
2021-03-24 11:28:01,035: main    : main             : INFO    : 2  
2021-03-24 11:28:01,132: main    : main             : INFO    : 3  
2021-03-24 11:28:01,229: main    : main             : INFO    : 4  
2021-03-24 11:28:01,326: main    : main             : INFO    : 5  
2021-03-24 11:28:01,421: main    : main             : INFO    : 6  
2021-03-24 11:28:01,518: main    : main             : INFO    : 7  
2021-03-24 11:28:01,613: main    : main             : INFO    : 8  
2021-03-24 11:28:01,710: main    : main             : INFO    : 9  
.  
.  
.  
2021-03-24 11:28:11,121: main    : main             : INFO    : 106  
2021-03-24 11:28:11,158: main    : main             : ERROR   : ВАЖНО:  закрытие подключения по команде администратора  
SSL connection has been closed unexpectedly  
  
2021-03-24 11:28:11,158: main    : main             : INFO    : 107  
2021-03-24 11:28:11,366: main    : main             : ERROR   : ВАЖНО:  система баз данных останавливается  
could not connect to server: Connection refused  
	Is the server running on host "172.1.1.228" and accepting  
	TCP/IP connections on port 5432?  
  
2021-03-24 11:28:11,367: main    : main             : INFO    : 108  
2021-03-24 11:28:11,399: main    : main             : ERROR   : could not connect to server: Connection refused  
	Is the server running on host "172.1.1.228" and accepting  
	TCP/IP connections on port 5432?  
.  
.  
.  
2021-03-24 11:28:18,667: main    : main             : INFO    : 333  
2021-03-24 11:28:18,699: main    : main             : ERROR   : could not connect to server: Connection refused  
	Is the server running on host "172.1.1.228" and accepting  
	TCP/IP connections on port 5432?  
  
2021-03-24 11:28:18,699: main    : main             : INFO    : 334  
2021-03-24 11:28:19,079: main    : main             : INFO    : 335  
2021-03-24 11:28:19,174: main    : main             : INFO    : 336  
2021-03-24 11:28:19,269: main    : main             : INFO    : 337  
2021-03-24 11:28:19,365: main    : main             : INFO    : 338  
2021-03-24 11:28:19,461: main    : main             : INFO    : 339  
2021-03-24 11:28:19,556: main    : main             : INFO    : 340  
2021-03-24 11:28:19,651: main    : main             : INFO    : 341  
.  
.  
.  
2021-03-24 11:28:23,010: main    : main             : INFO    : 376  
2021-03-24 11:28:23,104: main    : main             : INFO    : 377  
2021-03-24 11:28:23,200: main    : main             : INFO    : 378  
2021-03-24 11:28:23,295: main    : main             : INFO    : 379  
2021-03-24 11:28:23,390: main    : main             : INFO    : 380  
2021-03-24 11:28:23,485: main    : main             : INFO    : Количество отправленных на запись строк: 380  
2021-03-24 11:28:23,485: main    : main             : INFO    : Количество успешных соединений с базой: 2  
2021-03-24 11:28:23,486: main    : main             : INFO    : Количество ошибок при работе с базой: 228  
2021-03-24 11:28:23,486: main    : main             : INFO    : Пробуем получить статистику из БД...  
2021-03-24 11:28:23,758: main    : main             : INFO    : ***************************************  
2021-03-24 11:28:23,758: main    : main             : INFO    : Строк: 152  
2021-03-24 11:28:23,758: main    : main             : INFO    : Мин.задержка: 0:00:00.094456  
2021-03-24 11:28:23,759: main    : main             : INFO    : Макс.задержка: 0:00:07.953410  
2021-03-24 11:28:23,759: main    : main             : INFO    : Сред.задержка: 0:00:00.148717  
2021-03-24 11:28:23,759: main    : main             : INFO    : ***************************************  
2021-03-24 11:28:23,827: main    : main             : INFO    : Таблица guzya_2021_03_24_11_28 удалена.  
2021-03-24 11:28:23,827: main    : module           : INFO    : Окончание работы   
2021-03-24 11:28:23,827: main    : module           : INFO    : Времы выполнения скрипта: 0:00:23.401902  

